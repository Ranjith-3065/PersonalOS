<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Settings | PersonalOS</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
 :root {
    --bg-page: #f9f9f9;
    --sidebar-bg: #ffffff;
    --accent: #111827;
    --text-main: #111827;
    --text-sub: #71717a;
    --border: #e5e7eb;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
  body { background-color: var(--bg-page); color: var(--text-main); display: flex; min-height: 100vh; }

  /* SIDEBAR */
  aside {
    width: 260px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border);
    padding: 32px 20px;
    position: sticky;
    top: 0;
    height: 100vh;
  }

  /* NEW BACK BUTTON */
  .back-nav {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-sub);
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 32px;
    padding: 8px;
    border-radius: 8px;
    transition: 0.2s;
  }

  .back-nav:hover {
    background: #f3f4f6;
    color: var(--text-main);
  }

  .brand {
    font-weight: 800; font-size: 18px; color: var(--text-main);
    margin-bottom: 24px; display: flex; align-items: center; gap: 10px;
    padding-left: 8px;
  }

  .nav-item {
    display: flex; padding: 12px; font-size: 14px; font-weight: 600;
    color: var(--text-sub); text-decoration: none; border-radius: 8px;
    margin-bottom: 4px; transition: 0.2s;
  }

  .nav-item.active { background: #f3f4f6; color: var(--text-main); }
  .nav-item:hover:not(.active) { background: #f9fafb; color: var(--text-main); }

  /* MAIN LAYOUT */
  main {
    flex: 1; padding: 40px 60px; display: grid;
    grid-template-columns: 1fr 300px; gap: 32px;
    max-width: 1400px; margin: 0 auto;
  }

  .content-left { display: flex; flex-direction: column; gap: 24px; }
  header h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
  header p { color: var(--text-sub); font-size: 14px; }

  /* PROFILE HERO */
  .profile-hero {
    background: linear-gradient(135deg, #111827 0%, #374151 100%);
    border-radius: 24px; padding: 32px; color: white;
    display: flex; align-items: center; gap: 24px;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
  }

  .avatar-container { position: relative; width: 80px; height: 80px; cursor: pointer; }
  .avatar-large {
    width: 100%; height: 100%; background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2); border-radius: 20px;
    display: flex; align-items: center; justify-content: center;
    font-size: 32px; font-weight: 700; overflow: hidden;
  }

  .avatar-large img { width: 100%; height: 100%; object-fit: cover; display: none; }
  .avatar-overlay {
    position: absolute; inset: 0; background: rgba(0,0,0,0.4);
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    opacity: 0; transition: 0.3s; border-radius: 20px;
  }
  .avatar-container:hover .avatar-overlay { opacity: 1; }
  #photo-input { display: none; }

  /* SETTINGS CARD */
  .glass-card { background: white; border: 1px solid var(--border); border-radius: 24px; padding: 8px; }
  .setting-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 20px 24px; border-bottom: 1px solid var(--border);
  }
  .setting-row:last-child { border-bottom: none; }

  .info h4 { font-size: 14px; font-weight: 700; }
  .info p { font-size: 12px; color: var(--text-sub); margin-top: 2px; }

  .val-box {
    background: #f9fafb; padding: 8px 16px; border-radius: 10px;
    font-size: 13px; font-weight: 600; color: var(--text-main); border: 1px solid var(--border);
    min-width: 120px; text-align: right;
  }

  .edit-btn {
    border: none; background: transparent; color: #4b5563;
    font-weight: 700; font-size: 13px; cursor: pointer;
    margin-left: 20px; transition: 0.2s;
  }
  .edit-btn:hover { color: var(--accent); }

  /* RIGHT SIDEBAR */
  .content-right { display: flex; flex-direction: column; gap: 20px; }
  .stat-card { background: white; border: 1px solid var(--border); border-radius: 20px; padding: 20px; }
  .stat-card h5 { font-size: 12px; color: var(--text-sub); text-transform: uppercase; margin-bottom: 12px; }
  .status-badge {
    display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px;
    background: #f3f4f6; color: #374151; border-radius: 20px; font-size: 12px; font-weight: 700;
  }
  .progress-bar { height: 6px; background: #f3f4f6; border-radius: 10px; overflow: hidden; margin-top: 10px; }
  .progress-fill { width: 85%; height: 100%; background: var(--accent); }
</style>
</head>
<body>

<aside>
  <a href="/personalOS/dashboard" class="back-nav">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="19" y1="12" x2="5" y2="12"></line>
      <polyline points="12 19 5 12 12 5"></polyline>
    </svg>
    Back to Dashboard
  </a>

  <div class="brand">
    <div style="width:24px; height:24px; background:var(--accent); border-radius:6px;"></div>
    PersonalOS
  </div>

  <nav>
    <a href="/personalOS/profile" class="nav-item active">General Settings</a>
    <a href="/personalOS/preferences" class="nav-item">Account Appearance</a>
    <a href="/personalOS/account" class="nav-item">Account Security</a>
    <a href="#" class="nav-item">API Engine</a>
  </nav>
</aside>

<main>
  <div class="content-left">
    <header>
      <h1>Control Panel</h1>
      <p>Manage your core identity and system preferences.</p>
    </header>

    <!-- PROFILE HERO -->
    <div class="profile-hero">
      <div class="avatar-container">
        <div class="avatar-large">
          <span id="avatar_letter">R</span>
          <div class="avatar-overlay">Edit</div>
        </div>
      </div>
      <div>
        <h2 id="hero_name">Loading Profile...</h2>
        <p id="hero_username" style="opacity:0.8;font-size:14px">@username</p>
      </div>
    </div>

    <!-- SETTINGS -->
    <div class="glass-card">

      <!-- GLOBAL EDIT BUTTON -->
      <div class="setting-row" style="justify-content:flex-end;border-bottom:none">
        <button class="edit-btn">Edit Profile</button>
      </div>

      <div class="setting-row">
        <div class="info">
          <h4>Legal Name</h4>
          <p>Verified identity for system logs.</p>
        </div>
        <div class="val-box" id="name_val">---</div>
      </div>

      <div class="setting-row">
        <div class="info">
          <h4>Username</h4>
          <p>Your unique public identifier.</p>
        </div>
        <div class="val-box" id="username_val">---</div>
      </div>

      <div class="setting-row">
        <div class="info">
          <h4>Primary Email</h4>
          <p>Used for encrypted notifications.</p>
        </div>
        <div class="val-box" id="email_val">---</div>
      </div>

      <div class="setting-row">
        <div class="info">
          <h4>Bio</h4>
          <p>A short description of yourself.</p>
        </div>
        <div class="val-box" id="bio_val">No bio set</div>
      </div>

      <div class="setting-row">
        <div class="info">
          <h4>Phone Number</h4>
          <p>For two-factor authentication.</p>
        </div>
        <div class="val-box" id="phone_val">Not linked</div>
      </div>

      <div class="setting-row">
        <div class="info">
          <h4>Timezone</h4>
          <p>Synchronize your system timeline.</p>
        </div>
        <div class="val-box" id="timezone_val">UTC +0:00</div>
      </div>

    </div>
  </div>

  <div class="content-right">
    <div class="stat-card">
      <h5>System Status</h5>
      <div class="status-badge">
        <div style="width:6px;height:6px;background:#10b981;border-radius:50%"></div>
        All Systems Online
      </div>
    </div>

    <div class="stat-card">
      <h5>Account Health</h5>
      <p style="font-size:18px;font-weight:700">85% Secure</p>
      <div class="progress-bar"><div class="progress-fill"></div></div>
      <p style="font-size:11px;color:var(--text-sub);margin-top:10px">
        Enable 2FA to reach 100%.
      </p>
    </div>
  </div>
</main>

</body>

<script>
  (async () => {
    const res = await fetch('/personalOS/profile/data');
    const data = await res.json();
    if(data.success){
      document.getElementById('name_val').textContent = data.name || '---';
    document.getElementById('username_val').textContent = data.username || '---';
    document.getElementById('email_val').textContent = data.email || '---';
    document.getElementById('bio_val').textContent = data.bio || 'No bio set';
    document.getElementById('phone_val').textContent = data.phonenumber || 'Not linked';
    document.getElementById('timezone_val').textContent = data.timezone || 'UTC +0:00';

    document.getElementById('hero_name').textContent = data.name || 'User';
    document.getElementById('hero_username').textContent = '@' + (data.username || 'username');
      const avatar = document.getElementById('avatar_letter').textContent =
  data.name ? data.name.charAt(0).toUpperCase() : '?';

    }
  })();
  const editBtn = document.querySelector('.edit-btn');
const fields = [
  'name_val',
  'username_val',
  'bio_val',
  'timezone_val'
];

let editing = false;

editBtn.addEventListener('click', () => {
  editing = !editing;

  if (editing) {
    // EDIT MODE
    editBtn.textContent = 'Save Changes';
    editBtn.classList.replace('edit-btn', 'save-btn');

    fields.forEach(id => {
      const box = document.getElementById(id);
      const value = box.textContent.trim();
      box.innerHTML = `<input type="text" class="edit-input" value="${value === '---' || value === 'Not linked' ? '' : value}">`;
    });

  } else {
  editBtn.textContent = 'Edit Profile';
  editBtn.classList.replace('save-btn', 'edit-btn');

  const payload = {};

  fields.forEach(id => {
    const box = document.getElementById(id);
    const input = box.querySelector('input');
    payload[id.replace('_val', '')] = input.value.trim();
  });

  fetch('/personalOS/profile/updatedata', {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    if (!data.success) return;

    // ðŸ‘‡ THIS IS WHAT YOU ASKED
    document.querySelector('#name_val').textContent = data.name;
    document.querySelector('#username_val').textContent = data.username;
    document.querySelector('#email_val').textContent = data.email;
    document.querySelector('#bio_val').textContent = data.bio || 'No bio set';
    document.querySelector('#phone_val').textContent = data.phone || 'Not linked';
    document.querySelector('#timezone_val').textContent = data.timezone;

    document.querySelector('#hero_name').textContent = data.name;
    document.querySelector('#hero_username').textContent = '@' + data.username;
    document.querySelector('#avatar_letter').textContent =
      data.name.charAt(0).toUpperCase();
  })
  .catch(err => {
    console.error(err);
  });
}

});

</script>
</html>